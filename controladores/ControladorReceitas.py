#######################################################
# 
# ControladorReceitas.py
# Python implementation of the Class ControladorReceitas
# Generated by Enterprise Architect
# Created on:      15-Apr-2024 9:30:53 PM
# Original author: rlnet
# 
#######################################################
from limites.TelaReceitas import TelaReceitas
from controladores.ControladorGeraIdReceita import ControladorGeraIdReceita
from DAOs.DAOReceita import DAOReceita

class ControladorReceitas:
    C_RECEITAS = "C_RECEITAS"
    R_RECEITAS = "R_RECEITAS"
    D_RECEITAS = "D_RECEITAS"
    PROXIMO = "PROXIMO"
    VOLTAR = "VOLTAR"


    def __init__(self, imoveis: list, plataformas: list):
        self.__tela = TelaReceitas(imoveis, plataformas)
        self.__gera_id = ControladorGeraIdReceita()
        self.__dao = DAOReceita("receitas.pkl")
        self.__receitas = self.__dao.get_all()
        self.__imoveis = imoveis
        self.__plataformas = plataformas
        self.__gera_id = ControladorGeraIdReceita()

    @property
    def tela(self):
        return self.__tela

    @property
    def dao(self):
        return self.__dao

    @property
    def receitas(self):
        return self.__receitas

    @property
    def imoveis(self):
        return self.__imoveis

    @property
    def plataformas(self):
        return self.__plataformas

    def abrir_menu(self, imoveis, plataformas):
        while True:
            match self.__tela.abrir_menu():
                case self.C_RECEITAS:
                    self.cadastrar_receita(imoveis, plataformas)
                case self.R_RECEITAS:
                    self.listar_receitas(imoveis, plataformas)
                case self.D_RECEITAS:
                    self.excluir_receita(imoveis, plataformas)
                case self.VOLTAR:
                    return
                case None:
                    return
    def cadastrar_receita(self, imoveis, plataformas):
        data, obs, valor, imovel, tags, plataforma = self.__tela.cadastrar_receita(imoveis, plataformas)
        if data is None:
            return
        elif (self.__dao.create(data=data, obs=obs, valor=valor, imovel=imovel, plataforma=plataforma, id=self.__gera_id.gera_id(), tags=tags)):
            self.__tela.cadastrar_sucesso()
            return
        else:
            self.__tela.cadastrar_erro()

    def excluir_receita(self):
        receita = self.__tela.excluir_receita(self.__dao.get_all())
        if receita is None:
            return
        elif self.__dao.delete(receita):
            self.__tela.excluir_sucesso()
            return
        else:
            self.__tela.excluir_erro()

    def listar_receitas(self):
        self.__tela.listar_receitas(self.__dao.get_all())


    def get_all(self):
        return self.__receitas